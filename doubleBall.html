<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>彩票</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" href="css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="css/default.css">
		<link href="http://cdn.bootcss.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" href="css/animate.css"/>
		<link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_526177_mbhc815vs0rg4x6r.css"/>
		<link rel="stylesheet" href="css/mui.min.css">
		<script src="js/jquery.min.js"></script>
		<script type="text/javascript" src="js/main.js"></script>
		<style>
			html,
			body {
				background-color: #efeff4;
				font-size: 13px;
				padding-bottom: 50px;
				
			}
			.mui-bar{
					background: red;
				}
				.mui-bar-nav {
				    -webkit-box-shadow: 0 1px 6px #ccc;
				}
				.mui-title,.mui-icon-left-nav{
					color: #fff;
				}
			/*自定义css*/
			.mui-content{
				background: #fff;
			}
			ul,li{
				list-style: none;
				margin: 0;
				padding: 0;
			}
			.padd5{
				padding: 5px;
			}
			.font-12{
				font-size: 12px;
			}
			.com-option{
				display: inline-block;
				border:1px solid #Ccc;
				padding: 0 10px;
				color:#000;
				margin-top: 5px;
			}
			.mui-content{
				background: #fff;
				z-index: 2;
			}
			.red li{
				display: inline-block;
				height: 35px;
				width: 35px;
				line-height: 35px;
				border:1px solid red;
				text-align: center;
				border-radius: 30px;
				margin:6px;
				color: red;
			}
			.blue li{
				display: inline-block;
				height: 35px;
				width: 35px;
				line-height: 35px;
				border:1px solid red;
				text-align: center;
				border-radius: 30px;
				margin:6px;
				color: blue;
				border:1px solid blue;
			}
			.red .active {
				color: #fff;
				background: red;
			}
			
			.blue .active {
				color: #FFF;
				background: blue;
			}
			.mr20{
				margin-right: 20px;
			}
			.footer{
				position: fixed;
			    left: 0;
			    right: 0;
			    bottom: 0;
				background: rgba(0,0,0,0.8);
				height: 50px;
				color: #fff;
			}
			.icon-delete{
				padding: 0 10px 0 10px;
				border-right: 1px solid rgba(255,255,255,0.6);
			}
			.mui-icon-trash{
				color: #fff;
			}
			#btn-sure{
				display: block;
				padding: 6px 22px;
				font-size: 15px;
    				border-radius: 3px;
			}
			
			
			/*投注单css*/
			.mui-scroll-wrapper, .mui-scroll{
				background: #fff;
			}
			.mui-table-view:before,.mui-table-view:after{
				height: 0;
			}
			.stage{
				color: red;
				padding: 10px;
				padding-bottom: 3px;
				border-bottom: 1px solid #ccc;
			}		
			.border{
				border: 1px solid #ccc;
			}	
			.padd{
				padding: 3px 5px;
			}
			.mr5{
				margin-right: 5px!important;
			}
			.mui-table-view-cell:after{
				height: 0;	
			}
			.fl{
				float: left;
			}
			.w30{
				width: 30%;
			}
			.content-list{
				width: 90%;
			    margin: 20px auto;
			    padding-bottom: 20px;
			   height: 200px;
			   overflow-y: scroll;
			   overflow: auto;
			}
			.color-red{
				color: red;
			}
			.color-blue{
				color: blue;
			}
			.color-gray{
				color:#ccc;
			}
			.content-list ul{
				width: 90%;
			    border-bottom: 1px dashed #ccc;
			    margin: 0 auto;
			}
			.content-list ul li{
				width: 8%;
				display: inline-block;
				padding: 8px 0;
			}
			/*.content-list ul li:visible:last-child{
				color: blue;
			}*/
			.computerSelect li:nth-child(8){
				color: blue;
			}
			#beetinglist{
				display: none;
				z-index: 100;
				width: 100%;
				background: #fff;
				position: fixed;
				left: 0;
				right: 0;
				bottom: 0;
			}
			#mask{
				display: none;
				position: fixed;
			    width: 100%;
			    height: 100%;
			    background: rgba(0,0,0,0.7);
			    z-index: 20;
			    left: 0;
			    top: 0;
			}
			.mult{
				width: 90%;
				margin: 10px auto;
			}
			.mult span{
				height: 30px;
				line-height: 30px;
				text-align: center;
				border: 1px solid #ccc;
				font-size: 16px;
				
			}
			.mult span{
				display: inline-block;
			}
			.mult input{
				display: inline-block;
			}
			.del{
				width: 20%;
				background:rgba(0, 0, 0, 0.09);
				color: #000;
				font-size: 16px;
			}
			.num{
				width: 20%;
				background: #fff;
				color: #000;
				border: 1px solid #ccc;
				height: 30px;
    				text-align: center;
			}
			.plus{
				width: 20%;
				background: rgba(0, 0, 0, 0.09);
				color: #000;
				font-size: 16px;
				
			}
			.color-white{
				color: white;
			}
			.color-yellow{
				color: yellow;
			}
			.finish-beeting{
				padding-top: 5px;
				padding-left: 40%;
				margin-top: 20px;
				height:50px;
				background: rgba(0,0,0,0.9);
			}
			.playAuth{
				display: block;
				width: 80px;
				height: 25px;
				line-height: 25px;
				text-align: center;
				border: 1px solid #ccc;
				margin-right: 20px;
				border-radius: 20px;
				font-size: 14px;
			}
			.cont{
				position: absolute;
			    padding: 10px 20px;
			    background: rgba(0,0,0,0.7);
			    left: 33%;
			    bottom: 30%;
			    border-radius: 5px;
			    color: #fff;
			    display: none;
			    }
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">双色球投注</h1>
		</header>
		<div id="loading">
			<div id="loading-center">
				<div id="loading-center-absolute">
					<div class="object" id="object_one"></div>
					<div class="object" id="object_two"></div>
					<div class="object" id="object_three"></div>
				</div>
			</div>
		</div>
		<div class="mui-content">
			<p class="mui-clearfix padd5 font-12"><span class="mui-pull-left" style="margin-top: 7px;">最少选择6个<i style="color: red;">红球</i>，1个<i style="color: blue;">蓝球</i></span><span class="mui-pull-right com-option">机选</span></p>
			<!--红色球和蓝色球开始-->
			<div class="mui-content-padded ball-list">
				<ul class="mui-table-view red">
				
				</ul>
				
				<ul class="mui-table-view blue">
					
				</ul>
			</div>
			<span class="mui-pull-right playAuth">？玩法说明</span>
			<div id="mask">
				
			</div>
			<!--红色球和蓝色球结束-->	
			<!--底部开始  ****确定按钮-->
			<div class="footer">
				<div class="mui-content-padded mui-clearfix">
					<div class="mui-pull-left icon-delete mr20">
						<span class="mui-icon mui-icon-trash"></span>
					</div>
					<div class="mui-pull-left mr20" style="margin-top: 3px;">
						<span class="Betting">0</span>注<span><span class="money" style="margin-left: 3px;">0</span>元</span>
					</div>
					<div class="mui-pull-right" style="margin-top: -3px;">
						<a href="javascript:;" class="mui-btn-danger" id="btn-sure">确定</a>
					</div>
				</div>
			</div>
		</div>
		<!--投注单-->		
		<div id="beetinglist" class="mui-page">
			<p class="stage">第18014期 02-01 19:35(周四)截止投注</p>
			<ul class="mui-table-view mui-text-center" style="overflow: hidden;padding-left: 26px;">
				<li class="mui-table-view-cell mui-col-xs-4 mui-col-sm-3 border padd mr5 mui-pull-left w30 selectOne"><i class="icon iconfont icon-jiahao"></i>机选1注</li>
				<li class="mui-table-view-cell mui-col-xs-4 mui-col-sm-3 border padd mr5 mui-pull-left w30 selectFive"><i class="icon iconfont icon-jiahao"></i>机选5注</li>
				<li class="mui-table-view-cell mui-col-xs-4 mui-col-sm-3 border padd mui-pull-left w30 goToselect"><i class="icon iconfont icon-jiahao"></i>继续选号</li>
			</ul>
			<div class="content-list">
				
			</div>
			<div class="deleteAll" style="overflow: hidden;padding-left: 26px; padding-right: 26px;">
				<div class="mui-pull-left">
					<input type="checkbox" name="" id="" value="" style="vertical-align: middle;" checked="checked"/>
					<label for="" style="font-size: 10px;color: #333;">我已阅读并同意<i style="color: #0062cc;font-style: normal;" class="service">《服务协议》</i></label>
				</div>
				<div class="mui-pull-right" style="color: #ccc; font-size: 12px;">
					<span>清空所有</span>
				</div>
			</div>
			<p class="cont">注册成功</p>
			<div class="mult">
				投<span class="del">-</span> <input class="num" value="1"> <span class="plus">+</span>倍
			</div>
			<div class="finish-beeting">
				<div class="mui-pull-left mui-text-center">
					<p  style="margin-bottom: 0;"><span class="finish-money color-yellow">0</span><span class="color-white">元</span></p>
					<p  style="margin-bottom: 0;" class="color-white"><span class="finish-beetNum">0</span>注 <span class="mul-num"></span>倍</p>
				</div>
				<div class="mui-pull-right" style="margin-top: 9px;margin-right: 5px;">
					<button class="mui-btn mui-btn-danger" id="button" style="padding: 5px 20px;border-radius: 3px;">投注</button>
				</div>
			</div>
		</div>
	</body>
	<script src="js/mui.js"></script>
	<script src="js/mui.view.js"></script>
	<script src="js/doubleBall.js"></script>
	<script src="js/select.js"></script>
	<script src="js/common.js">	</script>
	<script>
		mui.init({
			swipeBack: false,
		});
		//帮助中心
		$(".playAuth").click(function(){
			window.location.href="help.html"
		});
		//服务协议
		$(".service").click(function(){
			window.location.href="service.html"
		})
		let btn_sure=document.getElementById("btn-sure");
		btn_sure.onclick=function(){
				let beet=document.querySelector('.Betting').innerHTML;
				let ALlmoney=document.querySelector('.money').innerHTML;
				let redActiveNum=document.querySelectorAll('.red .active');
				let blueActiveNum=document.querySelectorAll('.blue .active');
				var redActiveArr=[];
				var blueActiveArr=[];
				for (let i in redActiveNum){
					redActiveArr.push(redActiveNum[i].innerHTML);
				}
				let redArray=redActiveArr.splice(0,redActiveArr.length-6);//选中的红色球数组
			    let redStr=redArray.join();//红色球字符串
				for (let i in blueActiveNum){
					blueActiveArr.push(blueActiveNum[i].innerHTML)
				}
				let blueArray=blueActiveArr.splice(0,blueActiveArr.length-6);//选中的蓝色球数组
			    let blueStr=blueArray.join();//蓝色球字符串
			    var andArray=redArray.concat(blueArray); //合并之后的数组
				if(redActiveNum.length<6){
						mui.alert("请至少选择6个红球",'',function(){
						})
						return false;
					}else if(blueActiveNum.length<1){
						mui.alert("请至少选择1个蓝球",'',function(){
						})
						return false;
					}else{
						$("#mask").show();
						$("#beetinglist").show();
						var con_list=$(".content-list");
						var ul=$("<ul class='mui-table-view list'></ul>");
						var $li_01='<li class="mui-table-view-cell icon iconfont icon-2guanbi color-gray"></li>';
							ul.append($li_01);
      						con_list.append(ul);
      						//红球
      						$(redArray).each(function(index,value){
      							var val=redArray[index];
      							var $li='<li class="mui-table-view-cell color-red">'+val+'</li>';
				      			ul.append($li);
				      			
				      			con_list.append(ul)
      						})
      						//篮球
      						$(blueArray).each(function(index,value){
      							var val=blueArray[index];
      							var $li='<li class="mui-table-view-cell color-blue">'+val+'</li>';
				      			ul.append($li);
				      			con_list.append(ul)
      						});
      						let bett=$(".Betting").text();//注数
      						let $hiddenLi='<li class="mui-table-view-cell hiddedLi" style="display:none;" name="hiddenLI">'+bett+'</li>';
      						ul.append($hiddenLi);
      						$(".mul-num").text($(".num").val());
      						//计算总钱数
      						let bettArr=[];
							let aa=$("[name=hiddenLI]");
							for (let i=0;i<aa.length;i++){
								bettArr.push(aa[i].innerHTML)
							}
							var 	computerSelect=$(".computerSelect").length;//计算点击机选一注或则5注的注数
							var allBettNum=eval(bettArr.join("+"));//计算选择号码页面的总注数  --->计算一个数组的和
							if(bettArr.length == 0) allBettNum=0;
							allBettNum=computerSelect+allBettNum;
							$(".finish-beetNum").text(allBettNum);
							$(".finish-money").text(parseInt(2*$(".num").val()*(allBettNum)).toFixed(2));
					}
			}
			//删除某一个号码
			$(".content-list").on('click','.icon-2guanbi',function(){
				$(this).parent().remove();
				$(".mul-num").text($(".num").val());
					let bettArr=[];
					let aa=$("[name=hiddenLI]");
					for (let i=0;i<aa.length;i++){
						bettArr.push(aa[i].innerHTML)
					}
					var 	computerSelect=$(".computerSelect").length;//计算点击机选一注或则5注的注数
					var allBettNum=eval(bettArr.join("+"));//计算选择号码页面的总注数----->计算一个数组的和
					if(bettArr.length == 0) allBettNum=0;
					allBettNum=computerSelect+allBettNum;
					$(".finish-beetNum").text(allBettNum);
					$(".finish-money").text(parseInt(2*$(".num").val()*(allBettNum)).toFixed(2));
			})
			
			//弹窗
			$("#mask").click(function(){
				$(this).hide();
				$("#beetinglist").hide();
			})
			//继续选号
			$(".goToselect").click(function(){
				$("#mask").hide();
				$("#beetinglist").hide();
				deleteALlnumber();
				calculate();
				document.querySelector('.Betting').innerHTML=0;
				document.querySelector('.money').innerHTML=0;
				
			})
			//加倍
			$(".plus").click(function(){
				$(".num").val(parseInt($(".num").val())+1);
				$(".mul-num").text($(".num").val());
				$(".finish-money").text(parseInt(2*$(".num").val()*$(".finish-beetNum").text()).toFixed(2))
			})
			//减倍数
			$(".del").click(function(){
				$(".num").val(parseInt($(".num").val())-1);
				$(".mul-num").text($(".num").val())
				$(".finish-money").text(parseInt(2*$(".num").val()*$(".finish-beetNum").text()).toFixed(2))
				if($(".num").val()<=1){
					$(".num").val(1)
					$(".mul-num").text($(".num").val())
					$(".finish-money").text(parseInt(2*$(".num").val()*$(".finish-beetNum").text()).toFixed(2))
				}
			});
			var betting=$("#button");
			var uid=sessionStorage.getItem("uid");
			var token=sessionStorage.getItem("token");
			betting.click(function(){
				if(!uid) window.location.href="regisiter.html"
				var list=$(".list");   //所有选择的号码
				var bet=[];
				for(var i=0;i<list.length;i++){
					bet.push(list[i].innerText)
				}
				var newNum=[];//所有投注数组
				for(i = 1, len = bet.length+1; i < len; i++){
					  var a=  bet[i-1];
					  var newa="";
					  for(j = 1, lenj = a.length+1; j < lenj; j++){
					  b = a[j-1];
					  newa+=b;
					  if(j%2==0&&j<a.length)
					   newa+='|';
					  }
					  newNum.push(newa);
				}

				var bet_num=newNum.length;//投注数量
				var money=Number($(".finish-money").text())*100;  //钱数
				var multi=Number($(".num").val());	//倍数
				var data = {
						type:"DCB",
						bet:newNum,
						bet_num:bet_num,
						money:money,
						multi:multi,
						period:"1"
					};
					$.ajax({
						type:"post",
						url:host+"userBet/userBetToPay?uid="+uid+"&token="+token,
						dataType:"json",
						contentType:'application/json',
						data:JSON.stringify(data),
						async:true,
						success:function(res){
							var cont=$(".cont");
							if(res.code == 200){
								let url1=res.url;
								cont.text("投注成功").show().delay(2000).fadeOut();
									setTimeout(function(){
										window.location.href=url1+"&uid="+uid+"&token="+token
									},3000)
							}else{
								mui.alert(res.message,"提示",function(){
								})
							}
						}
					});
			})
	</script>
	

</html>